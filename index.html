<!DOCTYPE html>
<meta charset="utf-8">

<style>
html, body { margin:0; padding:0; overflow:hidden; }

svg {
  /* width: 100vw;
  height: 100vh; */
  width: 1920px;
  height: 943px;
}

.node circle {
  cursor: pointer;
  stroke-width: 1.5px;
}

.node text {
  stroke-width: 0;
  font: sans-serif;
  pointer-events: none;
  text-anchor: middle;
}

.title {
	position: absolute;
	width: 100%;
	top: 40px;
	left: 0;
	text-align: center;
	font-size: 22px;
	color: red;
}

</style>

<body>
<script src="d3.v5.min.js"></script>

<script>
data = {
  "id": 0,
  "name": 'Analytical Tools',
  "translate": 'translate(867.546451273351, 689.0670353156611)',
  "children": [
  {
    "id": 1,
    "name": "AB Testing",
    "children": [
      {
        "id": 110,
        "name": "AB Tasty",
        "translate": "translate(-19.682747905161705, 1723.925861561073)",
        "x": -19.682747905161705,
        "y": 1723.925861561073
      },
      {
        "id": 120,
        "name": "Adobe Target Standard",
        "translate": "translate(316.8010006372538, 1201.344508009975)",
        "x": 316.8010006372538,
        "y": 1201.344508009975
      },
      {
        "id": 130,
        "name": "Convert",
        "translate": "translate(-333.3170497350112, 1709.1326792832751)",
        "x": -333.3170497350112,
        "y": 1709.1326792832751
      },
      {
        "id": 140,
        "name": "Dynamic Yield",
        "translate": "translate(-462.73869705527943, 1381.8360660118192)",
        "x": -462.73869705527943,
        "y": 1381.8360660118192
      },
      {
        "id": 150,
        "name": "Google Content Experiments",
        "translate": "translate(-479.28801594229174, 1230.5805920296793)",
        "x": -479.28801594229174,
        "y": 1230.5805920296793
      },
      {
        "id": 160,
        "name": "Google Optimize 360",
        "translate": "translate(-462.92437591031916, 1505.413465153081)",
        "x": -462.92437591031916,
        "y": 1505.413465153081
      },
      {
        "id": 170,
        "name": "Google Website Optimizer",
        "translate": "translate(-192.10676676838602, 1726.0940594207023)",
        "x": -192.10676676838602,
        "y": 1726.0940594207023
      },
      {
        "id": 180,
        "name": "KISSmetrics",
        "translate": "translate(-402.89909249310404, 1611.1363191300356)",
        "x": -402.89909249310404,
        "y": 1611.1363191300356
      },
      {
        "id": 190,
        "name": "Maxymiser",
        "translate": "translate(126.66363433917854, 1653.1087541090747)",
        "x": 126.66363433917854,
        "y": 1653.1087541090747
      },
      {
        "id": 200,
        "name": "Mixpanel",
        "translate": "translate(339.5420493321467, 1333.207945075465)",
        "x": 339.5420493321467,
        "y": 1333.207945075465
      },
      {
        "id": 210,
        "name": "Monetate",
        "translate": "translate(-380.17232579159094, 1130.3002019802439)",
        "x": -380.17232579159094,
        "y": 1130.3002019802439
      },
      {
        "id": 220,
        "name": "Omniture Adobe Test and Target",
        "translate": "translate(-173.14463538901265, 975.327110446372)",
        "x": -173.14463538901265,
        "y": 975.327110446372
      },
      {
        "id": 230,
        "name": "Optimizely",
        "translate": "translate(2.5835719498047354, 996.4634294020436)",
        "x": 2.5835719498047354,
        "y": 996.4634294020436
      },
      {
        "id": 240,
        "name": "SiteSpect",
        "translate": "translate(146.7999839024592, 1029.586393561793)",
        "x": 146.7999839024592,
        "y": 1029.586393561793
      },
      {
        "id": 250,
        "name": "UserZoom",
        "translate": "translate(-300.8293826000626, 1033.0720525661814)",
        "x": -300.8293826000626,
        "y": 1033.0720525661814
      },
      {
        "id": 260,
        "name": "Visual Website Optimizer",
        "translate": "translate(265.4864070914561, 1508.4298326143407)",
        "x": 265.4864070914561,
        "y": 1508.4298326143407
      }
    ],
    "translate": "translate(-88.38572192205271, 1356.4681352834018)",
    "x": -88.38572192205271,
    "y": 1356.4681352834018
  },
  {
    "id": 2,
    "name": "Audience Targeting",
    "children": [
      {
        "id": 230,
        "name": "Campanja",
        "translate": "translate(71.91552662757476, 129.7514656133401)",
        "x": 71.91552662757476,
        "y": 129.7514656133401
      },
      {
        "id": 240,
        "name": "DemDex",
        "translate": "translate(-131.37670426715897, 640.2986740132487)",
        "x": -131.37670426715897,
        "y": 640.2986740132487
      },
      {
        "id": 250,
        "name": "Dstillery",
        "translate": "translate(-321.6925822150295, 650.6764997523125)",
        "x": -321.6925822150295,
        "y": 650.6764997523125
      },
      {
        "id": 270,
        "name": "HookLogic",
        "translate": "translate(-102.76819293129608, 28.25813690676886)",
        "x": -102.76819293129608,
        "y": 28.25813690676886
      },
      {
        "id": 275,
        "name": "Jumptap",
        "translate": "translate(-431.6330493542663, 47.002347565688865)",
        "x": -431.6330493542663,
        "y": 47.002347565688865
      },
      {
        "id": 280,
        "name": "MyBuys",
        "translate": "translate(151.28281434928476, 307.45140485742394)",
        "x": 151.28281434928476,
        "y": 307.45140485742394
      },
      {
        "id": 290,
        "name": "NuggAd",
        "translate": "translate(-609.0872980880441, 191.03414773613082)",
        "x": -609.0872980880441,
        "y": 191.03414773613082
      },
      {
        "id": 300,
        "name": "Parrable",
        "translate": "translate(-664.2300285568776, 416.1577604564101)",
        "x": -664.2300285568776,
        "y": 416.1577604564101
      },
      {
        "id": 310,
        "name": "Perfect Market",
        "translate": "translate(-606.2872190082916, 540.0447789477627)",
        "x": -606.2872190082916,
        "y": 540.0447789477627
      },
      {
        "id": 320,
        "name": "RadiumOne",
        "translate": "translate(52.95961659605973, 527.8466361987399)",
        "x": 52.95961659605973,
        "y": 527.8466361987399
      },
      {
        "id": 340,
        "name": "Rich Relevance",
        "translate": "translate(-421.24587552769003, 619.4992497105022)",
        "x": -421.24587552769003,
        "y": 619.4992497105022
      },
      {
        "id": 350,
        "name": "Sojern",
        "translate": "translate(142.87564160607968, 206.2848469335048)",
        "x": 142.87564160607968,
        "y": 206.2848469335048
      },
      {
        "id": 310,
        "name": "Turn",
        "translate": "translate(-684.5029172504791, 271.50415242188376)",
        "x": -684.5029172504791,
        "y": 271.50415242188376
      },
      {
        "id": 320,
        "name": "Viafoura",
        "translate": "translate(-243.1521577184963, 17.199859045724807)",
        "x": -243.1521577184963,
        "y": 17.199859045724807
      },
      {
        "id": 340,
        "name": "cXense",
        "translate": "translate(-542.6239100152684, 96.55247964737886)",
        "x": -542.6239100152684,
        "y": 96.55247964737886
      },
      {
        "id": 350,
        "name": "eyeReturn",
        "translate": "translate(-527.3422539017329, 598.6793028432338)",
        "x": -527.3422539017329,
        "y": 598.6793028432338
      }
    ],
    "translate": "translate(-287.92610461427455, 344.02452122938166)",
    "x": -287.92610461427455,
    "y": 344.02452122938166
  },
  {
    "id": 3,
    "name": "Conversion Optimization",
    "children": [
      {
        "id": 360,
        "name": "AT Internet",
        "translate": "translate(2369.086257674352, 1736.018913464194)",
        "x": 2369.086257674352,
        "y": 1736.018913464194
      },
      {
        "id": 370,
        "name": "Augur",
        "translate": "translate(1478.5769736672053, 1046.7488651233964)",
        "x": 1478.5769736672053,
        "y": 1046.7488651233964
      },
      {
        "id": 380,
        "name": "Bing Universal Event Tracking",
        "translate": "translate(1783.0080815902904, 879.6659814359006)",
        "x": 1783.0080815902904,
        "y": 879.6659814359006
      },
      {
        "id": 390,
        "name": "Boomtrain",
        "translate": "translate(1592.2761002132033, 1356.8221885552632)",
        "x": 1592.2761002132033,
        "y": 1356.8221885552632
      },
      {
        "id": 400,
        "name": "BounceBreaker",
        "translate": "translate(1545.4147873961558, 823.352372749354)",
        "x": 1545.4147873961558,
        "y": 823.352372749354
      },
      {
        "id": 410,
        "name": "Burt",
        "translate": "translate(2548.684742010997, 1448.940036444924)",
        "x": 2548.684742010997,
        "y": 1448.940036444924
      },
      {
        "id": 420,
        "name": "Cardlytics",
        "translate": "translate(2449.0781316437397, 1290.0125678847123)",
        "x": 2449.0781316437397,
        "y": 1290.0125678847123
      },
      {
        "id": 430,
        "name": "Cedexis",
        "translate": "translate(2376.336598121915, 1031.767015094563)",
        "x": 2376.336598121915,
        "y": 1031.767015094563
      },
      {
        "id": 440,
        "name": "ClickDensity",
        "translate": "translate(1917.7755005179724, 1835.4149675781696)",
        "x": 1917.7755005179724,
        "y": 1835.4149675781696
      },
      {
        "id": 450,
        "name": "Convertro",
        "translate": "translate(2293.41434137589, 1272.1806889653499)",
        "x": 2293.41434137589,
        "y": 1272.1806889653499
      },
      {
        "id": 460,
        "name": "Coremetrics",
        "translate": "translate(1974.5859918666008, 1799.7138002842908)",
        "x": 1974.5859918666008,
        "y": 1799.7138002842908
      },
      {
        "id": 470,
        "name": "Crowd Science",
        "translate": "translate(1411.085710199322, 1478.5561905550626)",
        "x": 1411.085710199322,
        "y": 1478.5561905550626
      },
      {
        "id": 480,
        "name": "Datalogix",
        "translate": "translate(2597.4917348831173, 1073.280615346689)",
        "x": 2597.4917348831173,
        "y": 1073.280615346689
      },
      {
        "id": 490,
        "name": "EightFold Logic",
        "translate": "translate(1429.1121022554375, 896.9301686764463)",
        "x": 1429.1121022554375,
        "y": 896.9301686764463
      },
      {
        "id": 500,
        "name": "Evergage",
        "translate": "translate(1384.4217819934747, 1127.6097674089256)",
        "x": 1384.4217819934747,
        "y": 1127.6097674089256
      },
      {
        "id": 510,
        "name": "Facebook Conversion Tracking",
        "translate": "translate(1665.4363934707162, 1753.6285617459594)",
        "x": 1665.4363934707162,
        "y": 1753.6285617459594
      },
      {
        "id": 520,
        "name": "Facebook Tag API",
        "translate": "translate(2169.806866276537, 926.4753852027893)",
        "x": 2169.806866276537,
        "y": 926.4753852027893
      },
      {
        "id": 530,
        "name": "FetchRev",
        "translate": "translate(1558.89077201494, 1427.4178916420055)",
        "x": 1558.89077201494,
        "y": 1427.4178916420055
      },
      {
        "id": 540,
        "name": "Flipp",
        "translate": "translate(1918.8207489621893, 1686.2755931353354)",
        "x": 1918.8207489621893,
        "y": 1686.2755931353354
      },
      {
        "id": 550,
        "name": "Fresh Relevance",
        "translate": "translate(1799.9841395279038, 1825.0603584860478)",
        "x": 1799.9841395279038,
        "y": 1825.0603584860478
      },
      {
        "id": 360,
        "name": "GlobalWebIndex",
        "translate": "translate(2366.850906111852, 1856.443412975913)",
        "x": 2366.850906111852,
        "y": 1856.443412975913
      },
      {
        "id": 370,
        "name": "Google Conversion Tracking",
        "translate": "translate(2061.9795615578305, 865.6928958851151)",
        "x": 2061.9795615578305,
        "y": 865.6928958851151
      },
      {
        "id": 380,
        "name": "Gubagoo",
        "translate": "translate(1891.6975347152904, 841.3871728421506)",
        "x": 1891.6975347152904,
        "y": 841.3871728421506
      },
      {
        "id": 390,
        "name": "Hotjar",
        "translate": "translate(2500.350196892891, 1239.4711143365132)",
        "x": 2500.350196892891,
        "y": 1239.4711143365132
      },
      {
        "id": 400,
        "name": "HubSpot Call to Actions",
        "translate": "translate(2458.238639935218, 1690.9123092727914)",
        "x": 2458.238639935218,
        "y": 1690.9123092727914
      },
      {
        "id": 410,
        "name": "I-Behavior",
        "translate": "translate(2355.893726385997, 1585.849704413674)",
        "x": 2355.893726385997,
        "y": 1585.849704413674
      },
      {
        "id": 420,
        "name": "IgnitionOne",
        "translate": "translate(2203.479132620302, 1723.0939887831498)",
        "x": 2203.479132620302,
        "y": 1723.0939887831498
      },
      {
        "id": 430,
        "name": "Jetlore",
        "translate": "translate(1853.28606101254, 933.694993610188)",
        "x": 1853.28606101254,
        "y": 933.694993610188
      },
      {
        "id": 440,
        "name": "Klaviyo",
        "translate": "translate(2081.228747588285, 1000.5457659180133)",
        "x": 2081.228747588285,
        "y": 1000.5457659180133
      },
      {
        "id": 450,
        "name": "LinkedIn Insights",
        "translate": "translate(2486.2054790712027, 1344.8265629887874)",
        "x": 2486.2054790712027,
        "y": 1344.8265629887874
      },
      {
        "id": 460,
        "name": "MailTrack",
        "translate": "translate(1654.6644830775383, 1658.6129702061658)",
        "x": 1654.6644830775383,
        "y": 1658.6129702061658
      },
      {
        "id": 470,
        "name": "Mercent",
        "translate": "translate(1570.347917230572, 1777.522132937875)",
        "x": 1570.347917230572,
        "y": 1777.522132937875
      },
      {
        "id": 480,
        "name": "MoEngage",
        "translate": "translate(2628.5058950393673, 1399.069677846689)",
        "x": 2628.5058950393673,
        "y": 1399.069677846689
      },
      {
        "id": 490,
        "name": "PayPal Marketing Solutions",
        "translate": "translate(2163.394695028875, 1882.6794972897276)",
        "x": 2163.394695028875,
        "y": 1882.6794972897276
      },
      {
        "id": 500,
        "name": "Project Sunblock",
        "translate": "translate(1387.2158493762872, 1624.9549822526756)",
        "x": 1387.2158493762872,
        "y": 1624.9549822526756
      },
      {
        "id": 510,
        "name": "Reflektion",
        "translate": "translate(1424.0283124160287, 1318.5913303006469)",
        "x": 1424.0283124160287,
        "y": 1318.5913303006469
      },
      {
        "id": 520,
        "name": "Rokt",
        "translate": "translate(2211.717999089037, 1147.2071967262268)",
        "x": 2211.717999089037,
        "y": 1147.2071967262268
      },
      {
        "id": 530,
        "name": "Scout Analytics",
        "translate": "translate(1486.2448979915025, 1533.5926963295055)",
        "x": 1486.2448979915025,
        "y": 1533.5926963295055
      },
      {
        "id": 540,
        "name": "Shortstack",
        "translate": "translate(1756.7644745481268, 1736.5688670611166)",
        "x": 1756.7644745481268,
        "y": 1736.5688670611166
      },
      {
        "id": 550,
        "name": "SiteApps",
        "translate": "translate(2476.4296961685286, 1588.6816963766728)",
        "x": 2476.4296961685286,
        "y": 1588.6816963766728
      },
      {
        "id": 360,
        "name": "SnapApp",
        "translate": "translate(2079.061355330602, 1775.4153978391942)",
        "x": 2079.061355330602,
        "y": 1775.4153978391942
      },
      {
        "id": 370,
        "name": "Sumo",
        "translate": "translate(1350.3291709328303, 1516.9914798694901)",
        "x": 1350.3291709328303,
        "y": 1516.9914798694901
      },
      {
        "id": 380,
        "name": "TUMRA",
        "translate": "translate(1996.1958257309154, 1007.0757104398068)",
        "x": 1996.1958257309154,
        "y": 1007.0757104398068
      },
      {
        "id": 390,
        "name": "TellApart",
        "translate": "translate(1451.4548111507033, 1384.4835655083882)",
        "x": 1451.4548111507033,
        "y": 1384.4835655083882
      },
      {
        "id": 400,
        "name": "TradePending",
        "translate": "translate(1646.2807541930308, 826.9846359329478)",
        "x": 1646.2807541930308,
        "y": 826.9846359329478
      },
      {
        "id": 410,
        "name": "Traqli",
        "translate": "translate(2188.249439276622, 1809.375583319924)",
        "x": 2188.249439276622,
        "y": 1809.375583319924
      },
      {
        "id": 420,
        "name": "Twitter Analytics",
        "translate": "translate(1577.327033010927, 956.4001411268998)",
        "x": 1577.327033010927,
        "y": 956.4001411268998
      },
      {
        "id": 430,
        "name": "Twitter Conversion Tracking",
        "translate": "translate(2613.55363913754, 1494.7449814031568)",
        "x": 2613.55363913754,
        "y": 1494.7449814031568
      },
      {
        "id": 440,
        "name": "Ve Interactive",
        "translate": "translate(2272.0545532523474, 981.5413103516071)",
        "x": 2272.0545532523474,
        "y": 981.5413103516071
      },
      {
        "id": 450,
        "name": "Visual IQ",
        "translate": "translate(2402.38309137589, 1506.8828374028499)",
        "x": 2402.38309137589,
        "y": 1506.8828374028499
      },
      {
        "id": 460,
        "name": "Visual Visitor",
        "translate": "translate(1546.2544488978508, 1621.7312563389783)",
        "x": 1546.2544488978508,
        "y": 1621.7312563389783
      },
      {
        "id": 470,
        "name": "WebTrends Optimize",
        "translate": "translate(1391.5272385196345, 1241.0598526644376)",
        "x": 1391.5272385196345,
        "y": 1241.0598526644376
      },
      {
        "id": 480,
        "name": "Woopra",
        "translate": "translate(2203.8067983596798, 1021.8696656396577)",
        "x": 2203.8067983596798,
        "y": 1021.8696656396577
      },
      {
        "id": 490,
        "name": "Yandex Metrika",
        "translate": "translate(1386.3628346773125, 1052.8394704342588)",
        "x": 1386.3628346773125,
        "y": 1052.8394704342588
      },
      {
        "id": 500,
        "name": "Yieldr",
        "translate": "translate(1384.4217819934747, 1182.932399244863)",
        "x": 1384.4217819934747,
        "y": 1182.932399244863
      },
      {
        "id": 510,
        "name": "comScore",
        "translate": "translate(2024.7542645644662, 1841.9214084256469)",
        "x": 2024.7542645644662,
        "y": 1841.9214084256469
      },
      {
        "id": 520,
        "name": "iGoDigital",
        "translate": "translate(2390.5386777999747, 1116.4724555152893)",
        "x": 2390.5386777999747,
        "y": 1116.4724555152893
      },
      {
        "id": 530,
        "name": "inSparq",
        "translate": "translate(1706.97670951494, 1572.709761759193)",
        "x": 1706.97670951494,
        "y": 1572.709761759193
      }
    ],
    "translate": "translate(2001.9586250813015, 1391.842694816915)",
    "x": 2001.9586250813015,
    "y": 1391.842694816915
  },
  {
    "id": 4,
    "name": "Retargeting",
    "children": [
      {
        "id": 555,
        "name": "AdRoll",
        "translate": "translate(2355.628618506275, -401.0681109486123)",
        "x": 2355.628618506275,
        "y": -401.0681109486123
      },
      {
        "id": 560,
        "name": "Adkontekst",
        "translate": "translate(2596.296916029792, -395.0772883300261)",
        "x": 2596.296916029792,
        "y": -395.0772883300261
      },
      {
        "id": 580,
        "name": "Adnologies",
        "translate": "translate(2272.239124750371, 162.40087868325975)",
        "x": 2272.239124750371,
        "y": 162.40087868325975
      },
      {
        "id": 590,
        "name": "Ambassador",
        "translate": "translate(2740.545915821889, -111.44499123324476)",
        "x": 2740.545915821889,
        "y": -111.44499123324476
      },
      {
        "id": 600,
        "name": "Appier",
        "translate": "translate(2493.521252744239, 73.8327890265719)",
        "x": 2493.521252744239,
        "y": 73.8327890265719
      },
      {
        "id": 610,
        "name": "ClickCertain",
        "translate": "translate(2732.603015778802, -219.86413813703268)",
        "x": 2732.603015778802,
        "y": -219.86413813703268
      },
      {
        "id": 620,
        "name": "Content Spread",
        "translate": "translate(2076.123018263094, -360.1889469163747)",
        "x": 2076.123018263094,
        "y": -360.1889469163747
      },
      {
        "id": 630,
        "name": "Criteo",
        "translate": "translate(2496.3549859401014, -378.96823973903133)",
        "x": 2496.3549859401014,
        "y": -378.96823973903133
      },
      {
        "id": 640,
        "name": "Facebook Custom Audiences",
        "translate": "translate(1980.5736919080102, -25.87621284627201)",
        "x": 1980.5736919080102,
        "y": -25.87621284627201
      },
      {
        "id": 650,
        "name": "Fetchback Retargeting",
        "translate": "translate(2354.2038462775236, 224.07963123775704)",
        "x": 2354.2038462775236,
        "y": 224.07963123775704
      },
      {
        "id": 660,
        "name": "Google Remarketing",
        "translate": "translate(2036.5558780331123, -236.80311778322329)",
        "x": 2036.5558780331123,
        "y": -236.80311778322329
      },
      {
        "id": 670,
        "name": "Merchenta",
        "translate": "translate(2169.8072136018727, 147.612957866895)",
        "x": 2169.8072136018727,
        "y": 147.612957866895
      },
      {
        "id": 555,
        "name": "Nano Interactive",
        "translate": "translate(2162.4424612797125, -421.03734255414207)",
        "x": 2162.4424612797125,
        "y": -421.03734255414207
      },
      {
        "id": 560,
        "name": "OptiMonk",
        "translate": "translate(2747.2020673969796, -4.817732990212846)",
        "x": 2747.2020673969796,
        "y": -4.817732990212846
      },
      {
        "id": 580,
        "name": "Perfect Audience",
        "translate": "translate(1983.6110729925585, -132.6533472383711)",
        "x": 1983.6110729925585,
        "y": -132.6533472383711
      },
      {
        "id": 590,
        "name": "ReTargeter",
        "translate": "translate(2646.1412527359516, -81.57427513827403)",
        "x": 2646.1412527359516,
        "y": -81.57427513827403
      },
      {
        "id": 600,
        "name": "ReachLocal",
        "translate": "translate(2454.413586728614, -445.7884573113187)",
        "x": 2454.413586728614,
        "y": -445.7884573113187
      },
      {
        "id": 610,
        "name": "Shareaholic",
        "translate": "translate(2621.267078278802, 150.66242741472513)",
        "x": 2621.267078278802,
        "y": 150.66242741472513
      },
      {
        "id": 620,
        "name": "Struq",
        "translate": "translate(2294.619356153719, -450.1581699388356)",
        "x": 2294.619356153719,
        "y": -450.1581699388356
      },
      {
        "id": 630,
        "name": "Triggit",
        "translate": "translate(2698.7058160182264, -300.9659356618829)",
        "x": 2698.7058160182264,
        "y": -300.9659356618829
      },
      {
        "id": 640,
        "name": "Twitter Ads",
        "translate": "translate(2073.3369975720725, 97.6218635926318)",
        "x": 2073.3369975720725,
        "y": 97.6218635926318
      },
      {
        "id": 650,
        "name": "mediaFORGE",
        "translate": "translate(2485.8422740118986, 218.87761249996407)",
        "x": 2485.8422740118986,
        "y": 218.87761249996407
      },
      {
        "id": 660,
        "name": "myThings",
        "translate": "translate(2684.1351016659246, 106.82531115278135)",
        "x": 2684.1351016659246,
        "y": 106.82531115278135
      }
    ],
    "translate": "translate(2346.972356122801, -128.11738556476405)",
    "x": 2346.972356122801,
    "y": -128.11738556476405
  },
  {
    "id": 5,
    "name": "Content Curation",
    "children": [
      {
        "id": 555,
        "name": "Amazon Link Enchancer",
        "translate": "translate(950.2024710453375, 1634.037556177189)",
        "x": 950.2024710453375,
        "y": 1634.037556177189
      },
      {
        "id": 560,
        "name": "Apester",
        "translate": "translate(927.0449018696359, 1066.5151951904818)",
        "x": 927.0449018696359,
        "y": 1066.5151951904818
      },
      {
        "id": 580,
        "name": "Crowdynews",
        "translate": "translate(666.7642101995898, 1062.0927779828812)",
        "x": 666.7642101995898,
        "y": 1062.0927779828812
      },
      {
        "id": 590,
        "name": "MGID",
        "translate": "translate(545.5385305679829, 1516.482235787019)",
        "x": 545.5385305679829,
        "y": 1516.482235787019
      },
      {
        "id": 600,
        "name": "Outbrain",
        "translate": "translate(712.6474734473643, 1646.2950387824312)",
        "x": 712.6474734473643,
        "y": 1646.2950387824312
      },
      {
        "id": 610,
        "name": "Taboola",
        "translate": "translate(512.9906805737235, 1305.420812119315)",
        "x": 512.9906805737235,
        "y": 1305.420812119315
      },
      {
        "id": 620,
        "name": "Yahoo Recommends",
        "translate": "translate(1102.387971876375, 1414.0483425123361)",
        "x": 1102.387971876375,
        "y": 1414.0483425123361
      },
      {
        "id": 630,
        "name": "ZergNet",
        "translate": "translate(1102.5883843776014, 1200.713736579328)",
        "x": 1102.5883843776014,
        "y": 1200.713736579328
      }
    ],
    "translate": "translate(791.0928395212386, 1369.4086472377378)",
    "x": 791.0928395212386,
    "y": 1369.4086472377378
  },
  {
    "id": 6,
    "name": "Marketing Automation",
    "children": [
      {
        "id": 555,
        "name": "Acoustic Campaign",
        "translate": "translate(409.039751318775, -82.45271731000145)",
        "x": 409.039751318775,
        "y": -82.45271731000145
      },
      {
        "id": 560,
        "name": "Act-On",
        "translate": "translate(787.687785170417, 46.9107182617708)",
        "x": 787.687785170417,
        "y": 46.9107182617708
      },
      {
        "id": 580,
        "name": "Active Campaign",
        "translate": "translate(882.586048578496, -14.638506666352995)",
        "x": 882.586048578496,
        "y": -14.638506666352995
      },
      {
        "id": 590,
        "name": "Adobe Analytics",
        "translate": "translate(905.0405447281391, 68.28833853970448)",
        "x": 905.0405447281391,
        "y": 68.28833853970448
      },
      {
        "id": 600,
        "name": "Adobe Marketing Cloud",
        "translate": "translate(1191.6568728614268, -169.7173818718656)",
        "x": 1191.6568728614268,
        "y": -169.7173818718656
      },
      {
        "id": 610,
        "name": "Ahalogy",
        "translate": "translate(1270.389758942864, -463.4804329978725)",
        "x": 1270.389758942864,
        "y": -463.4804329978725
      },
      {
        "id": 620,
        "name": "Akamai Acerno",
        "translate": "translate(1384.5718708021564, -364.953427507195)",
        "x": 1384.5718708021564,
        "y": -364.953427507195
      },
      {
        "id": 630,
        "name": "Autopilot",
        "translate": "translate(583.704229104164, -331.32730956325)",
        "x": 583.704229104164,
        "y": -331.32730956325
      },
      {
        "id": 640,
        "name": "BigDoor",
        "translate": "translate(558.6855083142602, -266.1051170716357)",
        "x": 558.6855083142602,
        "y": -266.1051170716357
      },
      {
        "id": 650,
        "name": "BloomReach",
        "translate": "translate(1393.5368540900238, -25.46288624263985)",
        "x": 1393.5368540900238,
        "y": -25.46288624263985
      },
      {
        "id": 660,
        "name": "BlueConic",
        "translate": "translate(1019.9374698299873, -509.07954600587954)",
        "x": 1019.9374698299873,
        "y": -509.07954600587954
      },
      {
        "id": 670,
        "name": "Braze",
        "translate": "translate(1278.9190300081225, 26.802296550977)",
        "x": 1278.9190300081225,
        "y": 26.802296550977
      },
      {
        "id": 555,
        "name": "Bronto",
        "translate": "translate(1311.039751318775, -149.45271731000145)",
        "x": 1311.039751318775,
        "y": -149.45271731000145
      },
      {
        "id": 560,
        "name": "Captora",
        "translate": "translate(774.687785170417, 130.9107182617708)",
        "x": 774.687785170417,
        "y": 130.9107182617708
      },
      {
        "id": 580,
        "name": "Century Interactive",
        "translate": "translate(1280.586048578496, -197.63850666635298)",
        "x": 1280.586048578496,
        "y": -197.63850666635298
      },
      {
        "id": 590,
        "name": "Clearbit",
        "translate": "translate(675.0405447281391, -14.28833853970448)",
        "x": 675.0405447281391,
        "y": -14.28833853970448
      },
      {
        "id": 600,
        "name": "Cloud Technologies",
        "translate": "translate(663.6568728614268, -153.7173818718656)",
        "x": 663.6568728614268,
        "y": -153.7173818718656
      },
      {
        "id": 610,
        "name": "Customer.io",
        "translate": "translate(1169.389758942864, -405.4804329978725)",
        "x": 1169.389758942864,
        "y": -405.4804329978725
      },
      {
        "id": 620,
        "name": "Custora",
        "translate": "translate(754.5718708021564, -514.953427507195)",
        "x": 754.5718708021564,
        "y": -514.953427507195
      },
      {
        "id": 630,
        "name": "DC Storm",
        "translate": "translate(1353.704229104164, -225.32730956325005)",
        "x": 1353.704229104164,
        "y": -225.32730956325005
      },
      {
        "id": 555,
        "name": "Drip",
        "translate": "translate(562.039751318775, 28.45271731000145)",
        "x": 562.039751318775,
        "y": 28.45271731000145
      },
      {
        "id": 560,
        "name": "Dynamic 1001",
        "translate": "translate(726.687785170417, 66.9107182617708)",
        "x": 726.687785170417,
        "y": 66.9107182617708
      },
      {
        "id": 580,
        "name": "Dynamic Logic",
        "translate": "translate(1238.586048578496, -80.638506666353)",
        "x": 1238.586048578496,
        "y": -80.638506666353
      },
      {
        "id": 590,
        "name": "Efficient Frontier",
        "translate": "translate(755.0405447281391, -25.28833853970448)",
        "x": 755.0405447281391,
        "y": -25.28833853970448
      },
      {
        "id": 600,
        "name": "Eloqua",
        "translate": "translate(761.6568728614268, -73.7173818718656)",
        "x": 761.6568728614268,
        "y": -73.7173818718656
      },
      {
        "id": 610,
        "name": "ExposeBox",
        "translate": "translate(1324.389758942864, -306.4804329978725)",
        "x": 1324.389758942864,
        "y": -306.4804329978725
      },
      {
        "id": 620,
        "name": "GetResponse",
        "translate": "translate(1271.5718708021564, -347.953427507195)",
        "x": 1271.5718708021564,
        "y": -347.953427507195
      },
      {
        "id": 630,
        "name": "Hubspot",
        "translate": "translate(1385.704229104164, -102.32730956325005)",
        "x": 1385.704229104164,
        "y": -102.32730956325005
      },
      {
        "id": 640,
        "name": "Hubspot Forms",
        "translate": "translate(632.6855083142602, -291.1051170716357)",
        "x": 632.6855083142602,
        "y": -291.1051170716357
      },
      {
        "id": 650,
        "name": "IXI Digital",
        "translate": "translate(712.5368540900238, -435.46288624263985)",
        "x": 712.5368540900238,
        "y": -435.46288624263985
      },
      {
        "id": 660,
        "name": "Iconosquare",
        "translate": "translate(927.9374698299873, -471.07954600587954)",
        "x": 927.9374698299873,
        "y": -471.07954600587954
      },
      {
        "id": 670,
        "name": "Informz",
        "translate": "translate(697.9190300081225, -381.802296550977)",
        "x": 697.9190300081225,
        "y": -381.802296550977
      },
      {
        "id": 555,
        "name": "Infusionsoft",
        "translate": "translate(1424.039751318775, -292.45271731000145)",
        "x": 1424.039751318775,
        "y": -292.45271731000145
      },
      {
        "id": 560,
        "name": "InsightExpress",
        "translate": "translate(648.687785170417, -63.9107182617708)",
        "x": 648.687785170417,
        "y": -63.9107182617708
      },
      {
        "id": 580,
        "name": "Jumpstart",
        "translate": "translate(824.586048578496, -105.638506666353)",
        "x": 824.586048578496,
        "y": -105.638506666353
      },
      {
        "id": 590,
        "name": "Kenshoo",
        "translate": "translate(1120.0405447281391, -16.28833853970448)",
        "x": 1120.0405447281391,
        "y": -16.28833853970448
      },
      {
        "id": 600,
        "name": "Leadin",
        "translate": "translate(973.6568728614268, -15.7173818718656)",
        "x": 973.6568728614268,
        "y": -15.7173818718656
      },
      {
        "id": 610,
        "name": "Listrak",
        "translate": "translate(1138.389758942864, -465.4804329978725)",
        "x": 1138.389758942864,
        "y": -465.4804329978725
      },
      {
        "id": 620,
        "name": "LiveRamp",
        "translate": "translate(1318.5718708021564, -416.953427507195)",
        "x": 1318.5718708021564,
        "y": -416.953427507195
      },
      {
        "id": 630,
        "name": "Liveclicker",
        "translate": "translate(1422.704229104164, -247.32730956325005)",
        "x": 1422.704229104164,
        "y": -247.32730956325005
      },
      {
        "id": 555,
        "name": "Localytics",
        "translate": "translate(406.039751318775, -169.45271731000145)",
        "x": 406.039751318775,
        "y": -169.45271731000145
      },
      {
        "id": 560,
        "name": "Mad Mimi Signup Form",
        "translate": "translate(972.687785170417, 191.9107182617708)",
        "x": 972.687785170417,
        "y": 191.9107182617708
      },
      {
        "id": 580,
        "name": "MailOptin",
        "translate": "translate(773.586048578496, -356.638506666353)",
        "x": 773.586048578496,
        "y": -356.638506666353
      },
      {
        "id": 590,
        "name": "Mailite Lite",
        "translate": "translate(1134.0405447281391, 75.28833853970448)",
        "x": 1134.0405447281391,
        "y": 75.28833853970448
      },
      {
        "id": 600,
        "name": "Marin Software",
        "translate": "translate(1017.6568728614268, -41.7173818718656)",
        "x": 1017.6568728614268,
        "y": -41.7173818718656
      },
      {
        "id": 610,
        "name": "Marketo",
        "translate": "translate(1138.389758942864, -542.4804329978725)",
        "x": 1138.389758942864,
        "y": -542.4804329978725
      },
      {
        "id": 620,
        "name": "Mautic",
        "translate": "translate(970.5718708021564, -559.953427507195)",
        "x": 970.5718708021564,
        "y": -559.953427507195
      },
      {
        "id": 630,
        "name": "Mindset Media",
        "translate": "translate(1248.704229104164, -246.32730956325005)",
        "x": 1248.704229104164,
        "y": -246.32730956325005
      },
      {
        "id": 640,
        "name": "Net-Results",
        "translate": "translate(574.6855083142602, -177.1051170716357)",
        "x": 574.6855083142602,
        "y": -177.1051170716357
      },
      {
        "id": 650,
        "name": "Netmining",
        "translate": "translate(1337.5368540900238, -74.46288624263985)",
        "x": 1337.5368540900238,
        "y": -74.46288624263985
      },
      {
        "id": 660,
        "name": "NinthDecimal",
        "translate": "translate(820.9374698299873, -498.07954600587954)",
        "x": 820.9374698299873,
        "y": -498.07954600587954
      },
      {
        "id": 670,
        "name": "Nudgespot",
        "translate": "translate(664.9190300081225, -350.802296550977)",
        "x": 664.9190300081225,
        "y": -350.802296550977
      },
      {
        "id": 555,
        "name": "Omniture SiteCatalyst",
        "translate": "translate(506.039751318775, -141.45271731000145)",
        "x": 506.039751318775,
        "y": -141.45271731000145
      },
      {
        "id": 560,
        "name": "Optify",
        "translate": "translate(928.687785170417, 124.9107182617708)",
        "x": 928.687785170417,
        "y": 124.9107182617708
      },
      {
        "id": 580,
        "name": "OwnerIQ",
        "translate": "translate(876.586048578496, -436.638506666353)",
        "x": 876.586048578496,
        "y": -436.638506666353
      },
      {
        "id": 590,
        "name": "Pardot",
        "translate": "translate(1063.0405447281391, -4.28833853970448)",
        "x": 1063.0405447281391,
        "y": -4.28833853970448
      },
      {
        "id": 600,
        "name": "Predictive Response",
        "translate": "translate(1184.6568728614268, -26.7173818718656)",
        "x": 1184.6568728614268,
        "y": -26.7173818718656
      },
      {
        "id": 610,
        "name": "Privy",
        "translate": "translate(1082.389758942864, -486.4804329978725)",
        "x": 1082.389758942864,
        "y": -486.4804329978725
      },
      {
        "id": 620,
        "name": "Rampmetrics",
        "translate": "translate(1182.5718708021564, -364.953427507195)",
        "x": 1182.5718708021564,
        "y": -364.953427507195
      },
      {
        "id": 630,
        "name": "Rapleaf",
        "translate": "translate(1403.704229104164, -166.32730956325005)",
        "x": 1403.704229104164,
        "y": -166.32730956325005
      },
      {
        "id": 555,
        "name": "Retention Science",
        "translate": "translate(537.039751318775, -19.45271731000145)",
        "x": 537.039751318775,
        "y": -19.45271731000145
      },
      {
        "id": 560,
        "name": "Sailthru Horizon",
        "translate": "translate(860.687785170417, 165.9107182617708)",
        "x": 860.687785170417,
        "y": 165.9107182617708
      },
      {
        "id": 580,
        "name": "Salesfusion",
        "translate": "translate(1495.586048578496, -109.638506666353)",
        "x": 1495.586048578496,
        "y": -109.638506666353
      },
      {
        "id": 590,
        "name": "SiteWit",
        "translate": "translate(1070.0405447281391, 125.28833853970448)",
        "x": 1070.0405447281391,
        "y": 125.28833853970448
      },
      {
        "id": 600,
        "name": "ThriveHive",
        "translate": "translate(1286.6568728614268, -115.7173818718656)",
        "x": 1286.6568728614268,
        "y": -115.7173818718656
      },
      {
        "id": 610,
        "name": "Tidio",
        "translate": "translate(1069.389758942864, -550.4804329978725)",
        "x": 1069.389758942864,
        "y": -550.4804329978725
      },
      {
        "id": 620,
        "name": "TradeDoubler",
        "translate": "translate(884.5718708021564, -526.953427507195)",
        "x": 884.5718708021564,
        "y": -526.953427507195
      },
      {
        "id": 630,
        "name": "Visual Sciences",
        "translate": "translate(1299.704229104164, -298.32730956325)",
        "x": 1299.704229104164,
        "y": -298.32730956325
      },
      {
        "id": 640,
        "name": "Voltn",
        "translate": "translate(581.6855083142602, -96.1051170716357)",
        "x": 581.6855083142602,
        "y": -96.1051170716357
      },
      {
        "id": 650,
        "name": "WebEngage",
        "translate": "translate(1333.5368540900238, -1.46288624263985)",
        "x": 1333.5368540900238,
        "y": -1.46288624263985
      },
      {
        "id": 660,
        "name": "WebTrends",
        "translate": "translate(784.9374698299873, -424.07954600587954)",
        "x": 784.9374698299873,
        "y": -424.07954600587954
      },
      {
        "id": 670,
        "name": "Wildfire",
        "translate": "translate(1223.9190300081225, 40.802296550977)",
        "x": 1223.9190300081225,
        "y": 40.802296550977
      },
      {
        "id": 555,
        "name": "Zaius",
        "translate": "translate(742.039751318775, -128.45271731000145)",
        "x": 742.039751318775,
        "y": -128.45271731000145
      },
      {
        "id": 560,
        "name": "aWeber",
        "translate": "translate(840.687785170417, 113.9107182617708)",
        "x": 840.687785170417,
        "y": 113.9107182617708
      },
      {
        "id": 580,
        "name": "dotdigital Engagement Cloud",
        "translate": "translate(528.586048578496, -219.63850666635298)",
        "x": 528.586048578496,
        "y": -219.63850666635298
      },
      {
        "id": 590,
        "name": "iPerceptions",
        "translate": "translate(1021.0405447281391, 75.28833853970448)",
        "x": 1021.0405447281391,
        "y": 75.28833853970448
      }
    ],
    "translate": "translate(982.5560963571761, -214.80688637347987)",
    "x": 982.5560963571761,
    "y": -214.80688637347987
  },
  {
    "id": 7,
    "name": "Product Recommendation",
    "children": [
      {
        "id": 555,
        "name": "Commerce Sciences",
        "translate": "translate(-856.54057094685, 547.9831738529701)",
        "x": -856.54057094685,
        "y": 547.9831738529701
      },
      {
        "id": 560,
        "name": "ExpertRec",
        "translate": "translate(-990.7345094462821, 1069.5130131836459)",
        "x": -990.7345094462821,
        "y": 1069.5130131836459
      },
      {
        "id": 580,
        "name": "ForeSee Results",
        "translate": "translate(-787.8560595758008, 1212.5852401410843)",
        "x": -787.8560595758008,
        "y": 1212.5852401410843
      },
      {
        "id": 590,
        "name": "Loomia",
        "translate": "translate(-1023.0851571761577, 816.4606598592845)",
        "x": -1023.0851571761577,
        "y": 816.4606598592845
      }
    ],
    "translate": "translate(-582.794534009764, 842.3251206264096)",
    "x": -582.794534009764,
    "y": 842.3251206264096
  },
  {
    "id": 8,
    "name": "Tag Management",
    "children": [
      {
        "id": 555,
        "name": "Adobe Dynamic Tag Management",
        "translate": "translate(1708.773149756275, 322.77718020062645)",
        "x": 1708.773149756275,
        "y": 322.77718020062645
      },
      {
        "id": 560,
        "name": "Adobe TagManager",
        "translate": "translate(2303.4056806782296, 554.0819523926302)",
        "x": 2303.4056806782296,
        "y": 554.0819523926302
      },
      {
        "id": 580,
        "name": "Ensighten",
        "translate": "translate(1721.9763073675585, 428.2778470670488)",
        "x": 1721.9763073675585,
        "y": 428.2778470670488
      },
      {
        "id": 590,
        "name": "Google Tag Manager",
        "translate": "translate(1842.2509939468891, 669.2194012380687)",
        "x": 1842.2509939468891,
        "y": 669.2194012380687
      },
      {
        "id": 600,
        "name": "Mezzobit",
        "translate": "translate(2205.5130740333016, 438.9011255133883)",
        "x": 2205.5130740333016,
        "y": 438.9011255133883
      },
      {
        "id": 610,
        "name": "QuBit OpenTag",
        "translate": "translate(2261.153064606927, 330.87068699724466)",
        "x": 2261.153064606927,
        "y": 330.87068699724466
      },
      {
        "id": 620,
        "name": "Signal",
        "translate": "translate(1783.0181598646564, 245.3629177076487)",
        "x": 1783.0181598646564,
        "y": 245.3629177076487
      },
      {
        "id": 630,
        "name": "TagMan",
        "translate": "translate(2017.380498635414, 733.5143805002265)",
        "x": 2017.380498635414,
        "y": 733.5143805002265
      },
      {
        "id": 640,
        "name": "Tealium",
        "translate": "translate(2218.1858745251975, 648.2156364808154)",
        "x": 2218.1858745251975,
        "y": 648.2156364808154
      },
      {
        "id": 650,
        "name": "Yahoo Tag Manager",
        "translate": "translate(1977.7151988165863, 237.38294544674142)",
        "x": 1977.7151988165863,
        "y": 237.38294544674142
      }
    ],
    "translate": "translate(1999.0430348337386, 487.10231178851893)",
    "x": 1999.0430348337386,
    "y": 487.10231178851893
  }
],

  "x": 980.3902715555618,
  "y": 420.6734326670203
};
const FIXED = true
let root_
let myjson

function stringify(){
  function getPos(root){

    function getPos_(child, pos){
      pos.push([child['x'], child['y']])
      if (child['children']){
        for (let child_ of child['children']){
          getPos_(child_, pos)
        }
      }
    }

    pos = []
    getPos_(root_, pos)
    return pos
  }

  function setPos(json, pos){

    function setPos_(child, pos){
      child['x'] = pos[i][0]
      child['y'] = pos[i][1]
      i += 1
      if (child['children']){
        for (let child_ of child['children']){
          setPos_(child_, pos)
        }
      }
    }

  let i = 0
  setPos_(json, pos)
  return json
  }

  positions = getPos(root_)
  myjson = setPos(myjson, positions)
  
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([JSON.stringify(myjson, null, 2)], {
    type: "text/plain"
  }));
  a.setAttribute("download", "data.json");
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

function generate_graph(data){

myjson = data

const width = 1920
const height = 943

let i = 0;
const max_visible_depth = 3;
let visible_depth = 0;

const root = d3.hierarchy(data);
let node, link;


// let transform = get_zoom_transform(0.7)
let zoom = d3.zoom().scaleExtent([1/10, 8]).on("zoom", zoomed);

var svg_ = d3.select('body')
  .append('svg')
  .call(zoom)
  // .call(zoom.transform, transform)

var svg = svg_
  .append('g')
  .attr('class', 'zoomable')
  // .attr('transform', transform)

d3.select("svg").on("dblclick.zoom", null);

let simulation
if (FIXED == false){
  simulation = d3.forceSimulation()
    .force('link', d3.forceLink()
      .distance(function(d){return [750, 350, 80][d.source.depth]})
      .id(function(d) { return d.id; }))
    .force('charge', d3.forceManyBody().strength(-300).distanceMax(180))
    .force('center', d3.forceCenter(width/2, height/2))
    .on('tick', ticked)
} else {
  simulation = d3.forceSimulation()
    .on('tick', ticked)
}


function start() {
  const nodes = flatten(root)

  if (FIXED == true){
    for (let i = 0; i < nodes.length; i++){
      nodes[i].x = nodes[i].data.x
      nodes[i].y = nodes[i].data.y
      nodes[i].vx = 0
      nodes[i].vy = 0
    }
  }

  const links = root.links()
  root_ = root

  link = svg
    .selectAll('.link')
    .data(links, function(d){ return d.target.id })
      
  const linkEnter = link
    .enter()
    .append('line')
    .attr('class', 'link')
    .style('stroke', '#000' )
    .style('opacity', '0.2')
    .style('stroke-width', 2);
  
  link = linkEnter.merge(link)
    

  node = svg
    .selectAll('.node')
    .data(nodes, function(d){ return d.id })

  const nodeEnter = node
    .enter()
    .append('g')
    .attr('class', 'node')
    .style('opacity', 1)
    .on('click', clicked)
    .call(d3.drag()
      .on('start', dragstarted)
      .on('drag', dragged)
      .on('end', dragended))
  
  nodeEnter.append('circle')
    .attr('stroke', '#666')
    .attr('stroke-width', 2)
    .style('fill', function(d) {return ['#d2b6c7', '#cde5cf', '#a9d3e3', '#fbf9ce'][d.depth]})
    .attr('r', function(d) {return [156, 112, 18, 9][d.depth]})

  nodeEnter.append('text')
    .text(function(d){ return d.data.name})
    .attr("dy", ".35em")
    .style("font-size", function(d){return `${[24, 18, 10, 6][d.depth]/10}em`})
    .call(wrap, function(d){return d.depth})

  node = nodeEnter.merge(node)
  update()

  simulation.nodes(nodes)
  if (FIXED == true){
    simulation.alpha(0)
  } else {
    simulation.force('link').links(links)
  }

  update()

  var title = document.createElement('div');
  title.className = "title";
  title.innerHTML = "Click on the nodes to see the next level.";
  document.body.appendChild(title);
}

function update() {
  transform = get_zoom_transform([1, .7, .5, .45,][visible_depth])
  svg.attr('transform', transform)
  svg_.call(zoom.transform, transform)

  link = svg
    .selectAll('.link')
    .style('opacity', function(d){ 
      if (d.source.depth <= visible_depth - 1) {
        return (d.source.depth == visible_depth - 1)? .3: .15
      } else {
      return 0
      }
    });

  node = svg
    .selectAll('.node')
    .style('opacity', function(d){ 
      if (d.depth <= visible_depth) {
        return ((d.depth == visible_depth) || d.depth == visible_depth-1)? 1: .5
      } else {
      return 0}
    });
}

function ticked() {
  node
    .attr("transform", function(d) { return `translate(${d.x}, ${d.y})` })
  link
    .attr("x1", function(d) { return d.source.x; })
    .attr("y1", function(d) { return d.source.y; })
    .attr("x2", function(d) { return d.target.x; })
    .attr("y2", function(d) { return d.target.y; });

}

function clicked(d) {
  if (!d3.event.defaultPrevented) {
    if (visible_depth >= d.depth + 1){
      visible_depth = d.depth;
    } else if (visible_depth < max_visible_depth){
      visible_depth = d.depth + 1
    }
    update()
    // if (!d3.event.active) simulation.alpha(0.01)
  }
}

function dragstarted(d) {
  if (!d3.event.active){
    if (FIXED){
      simulation.alpha(0.01).restart()
    } else {
      simulation.alpha(.30).restart()
    }
  }
  d.fx = d.x
  d.fy = d.y
}

function dragged(d) {
  d.fx = d3.event.x
  d.fy = d3.event.y
}

function dragended(d) {
  if (!d3.event.active){
    if (FIXED){
      simulation.alpha(0)
    } else {
      simulation.alpha(.30).restart()
    }
  }
  d.fx = null
  d.fy = null
}

function flatten(root) {
  const nodes = []
  function recurse(node) {
    if (node.children){
        node.children.forEach(recurse)
    }
  
    if (!node.id) node.id = ++i;
    else ++i;
    nodes.push(node)
  }
  recurse(root)

  return nodes
}

function zoomed() {
  if (svg){
    transform = d3.event.transform
    svg.attr("transform", transform);
  }
}

function get_zoom_transform(scale){
  let winWidth = window.innerWidth
  let winHeight = window.innerHeight

  // let sx = scale * winWidth / width
  let sy = scale * winHeight / height
  // let s = (winWidth < winHeight)? sy : sy
  let s = sy
  let w = width
  let h = height

  zoomWidth = (winWidth-s*w)/2
  zoomHeight = (winHeight-s*h)/2
  let transform = d3.zoomIdentity.translate(zoomWidth, zoomHeight).scale(s);
  return transform
}

function wrap(text, depth) {
    text.each(function () {
        var text = d3.select(this),
            words = text.text().split(/\s+/).reverse(),
            word,
            line = [],
            lineNumber = 0,
            lineHeight = parseFloat(text.style('font-size')),
            x = text.attr("x"),
            y = text.attr("y"),
            dy = parseFloat(text.attr("dy")),
            tspan = text.text(null)
                        .append("tspan")
                        .attr("x", 0)
                        .attr("y", y)
                        .attr("dy", dy + "em");
        while (word = words.pop()) {
            line.push(word);
            tspan.text(line.join(" "));
            if (tspan.node().getComputedTextLength() > 200) {
                line.pop();
                tspan.text(line.join(" "));
                line = [word];
                tspan = text.append("tspan")
                            .attr("x", 0)
                            .attr("y", y)
                            .attr("dy", ++lineNumber * lineHeight + dy + "em")
                            .text(word);
            }
        }
        // Center vertically
        // console.log(lineNumber)
        text.selectAll('tspan').attr('dy', function (d, i){ 
          if (d.depth == -1){
            return (lineHeight * i) - (lineHeight * lineNumber/2) + "em"
          } else {
            return (lineNumber)? (lineHeight * i + dy) - (lineHeight * lineNumber/2) + "em" : dy + "em"}
          })
          
    });
}

start()
}

// d3.json("my_graph_fixed7.json").then(generate_graph(data))
generate_graph(data)
</script>
